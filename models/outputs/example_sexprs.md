# Example S-Expressions Generated from Skills Analysis

This document contains S-expressions generated by analyzing the NeoExcelPPT localhost:4000
application and converting its skills into our DSL format.

## Source: Elixir Skill Modules + Phoenix LiveView

---

## 1. Project Scope Skill

The entry point. Takes file counts and computes totals and breakdowns.

```sexpr
(define-skill :project-scope
  (inputs :file-counts)
  (outputs :total-files :component-breakdown)
  (state {:simple 0 :medium 0 :complex 0})
  (compute
    (let [files (get input :file-counts)
          simple (get files :simple)
          medium (get files :medium)
          complex (get files :complex)
          total (+ simple medium complex)]
      (set :simple simple)
      (set :medium medium)
      (set :complex complex)
      (emit :total-files total)
      (emit :component-breakdown
        {:simple simple :medium medium :complex complex}))))
```

**UI Binding:**
```sexpr
(ui/section :id "project-scope" :title "Project Scope"
  (ui/display :id "project-scope-total-files" :bind :total-files :class "text-2xl font-bold text-blue-600")
  (ui/input :id "project-scope-simple-count" :type :number :bind :file-counts.simple :label "simple files x 15 components")
  (ui/input :id "project-scope-medium-count" :type :number :bind :file-counts.medium :label "medium files x 150 components")
  (ui/input :id "project-scope-complex-count" :type :number :bind :file-counts.complex :label "complex files x 300 components"))
```

---

## 2. Component Calculator Skill

Scales file counts by component multipliers and applies automation percentages.

```sexpr
(define-skill :component-calculator
  (inputs :file-count :breakdown :automation-pct)
  (outputs :scaled-effort :component-days)
  (state {:base-hours-per-file 15})
  (compute
    (let [files (get input :file-count)
          hours (get state :base-hours-per-file)
          auto-pct (get input :automation-pct)
          base-effort (* files hours)
          scaled (* base-effort (- 1 (/ auto-pct 100)))]
      (emit :scaled-effort scaled)
      (emit :component-days (/ scaled 8)))))
```

**UI Binding:**
```sexpr
(ui/section :id "component-calculator" :title "Component Scaling Calculator"
  (ui/table :id "component-calc-table"
    (ui/col :field :type :header "Component Type")
    (ui/col :field :count :header "Count" :type :number)
    (ui/col :field :avg-units :header "Avg Units" :type :number)
    (ui/col :field :total-units :header "Total Units" :type :number)
    (ui/col :field :time-per-unit :header "Time/Unit")
    (ui/col :field :base-days :header "Base Days" :type :number)
    (ui/col :field :auto-pct :header "Auto %" :type :number)
    (ui/col :field :final-days :header "Final Days" :type :number :class "text-green-600")))
```

---

## 3. Activity Calculator Skill

Manages activity/task records with team assignments.

```sexpr
(define-skill :activity-calculator
  (inputs :activity-update :team-assignment)
  (outputs :activity-totals :team-effort)
  (state {:activities {}})
  (compute
    (let [update (get input :activity-update)]
      (set :activities (merge (get state :activities) update))
      (emit :activity-totals (sum-values (get state :activities))))))
```

**UI Binding:**
```sexpr
(ui/section :id "activities-table" :title "Main Activities & Responsibilities"
  (ui/toggle :id "toggle-team" :label "Team Assignments" :bind :show-team-assignments)
  (ui/toggle :id "toggle-hours" :label "Detailed Hours" :bind :show-detailed-hours)
  (ui/toggle :id "toggle-summary" :label "Summary Columns" :bind :show-summary-columns)
  (ui/table :id "activities"
    (ui/col :field :name :header "Activity/Task")
    (ui/col :field :assignments :header "Team Assignments" :visible :show-team-assignments
      (ui/checkbox :member "SB")
      (ui/checkbox :member "CG")
      (ui/checkbox :member "S2P"))
    (ui/col :field :days-per-unit :header "Days/Unit")
    (ui/col :field :auto-pct :header "Auto %" :visible :show-summary-columns)
    (ui/col :field :base-days :header "Total Base" :visible :show-summary-columns)
    (ui/col :field :final-days :header "Total Final" :visible :show-summary-columns)))
```

---

## 4. Effort Aggregator Skill

Sums all effort sources into a total project estimate.

```sexpr
(define-skill :effort-aggregator
  (inputs :component-effort :activity-effort :buffer-days)
  (outputs :total-days :effort-breakdown)
  (state {:component 0 :activity 0 :buffer 0})
  (compute
    (let [comp (get input :component-effort)
          act (get input :activity-effort)
          buf (get input :buffer-days)
          total (+ comp act buf)]
      (emit :total-days total)
      (emit :effort-breakdown {:component comp :activity act :buffer buf}))))
```

**UI Binding:**
```sexpr
(ui/section :id "effort-breakdown" :title "Effort Breakdown"
  (ui/metric :id "effort-manual-days" :label "Base Manual Days" :bind :manual-days :class "text-orange-500")
  (ui/metric :id "effort-automation-days" :label "Base Automation Days" :bind :automation-days :class "text-orange-500")
  (ui/metric :id "effort-total-days" :label "Total Base Days" :bind :total-base-days :class "text-orange-500"))
```

---

## 5. Buffer Calculator Skill

Computes project buffers as percentages of base days.

```sexpr
(define-skill :buffer-calculator
  (inputs :base-days :buffer-config)
  (outputs :buffer-days :buffer-breakdown)
  (state {:leave-pct 10 :dependency-pct 15 :learning-pct 20})
  (compute
    (let [base (get input :base-days)
          leave (* base (/ (get state :leave-pct) 100))
          dep (* base (/ (get state :dependency-pct) 100))
          learn (* base (/ (get state :learning-pct) 100))]
      (emit :buffer-days (+ leave dep learn))
      (emit :buffer-breakdown {:leave leave :dependency dep :learning learn}))))
```

**UI Binding:**
```sexpr
(ui/section :id "proposed-buffers" :title "Proposed Buffers"
  (ui/table :id "buffer-table"
    (ui/col :field :type :header "Buffer Type")
    (ui/col :field :percentage :header "%" :type :number)
    (ui/col :field :days :header "Hours" :type :number))
  (ui/row :id "buffer-leave" :label "Leave Buffer" :description "Holidays and sick leave")
  (ui/row :id "buffer-dependency" :label "Dependency Buffer" :description "External dependency delays")
  (ui/row :id "buffer-learning" :label "Learning Curve Buffer" :description "New technology ramp-up"))
```

---

## 6. Complete Wiring Definition

How all skills connect in the dataflow graph.

```sexpr
(define-wiring
  ;; Project Scope -> Component Calculator
  (connect :project-scope:total-files -> :component-calculator:file-count)
  (connect :project-scope:component-breakdown -> :component-calculator:breakdown)

  ;; Component Calculator -> Effort Aggregator
  (connect :component-calculator:scaled-effort -> :effort-aggregator:component-effort)

  ;; Activity Calculator -> Effort Aggregator
  (connect :activity-calculator:activity-totals -> :effort-aggregator:activity-effort)

  ;; Effort Aggregator -> Buffer Calculator
  (connect :effort-aggregator:total-days -> :buffer-calculator:base-days)

  ;; Buffer Calculator -> Effort Aggregator (feedback loop for total)
  (connect :buffer-calculator:buffer-days -> :effort-aggregator:buffer-days))
```

---

## 7. UX Action Examples

Interactive behaviors expressed as composable S-expressions.

### File Count Update
```sexpr
(on-blur
  (let [type (get event :phx-value-type)
        value (get event :value)]
    (seq
      (validate :number value)
      (emit :file-counts (assoc (get state :file-counts) type (parse-int value)))
      (notify (str "Updated " type)))))
```

### Team Assignment Toggle
```sexpr
(on-click
  (let [activity (get event :phx-value-activity)
        member (get event :phx-value-member)
        current (get-assignment activity member)]
    (emit :team-assignment
      {:activity-id activity :member member :assigned (not current)})))
```

### View Toggle
```sexpr
(on-click
  (let [view (get event :phx-value-view)]
    (toggle-state (str "show-" view))))
```

### Conditional Save with Validation
```sexpr
(on-click
  (if (valid? (get state :form))
    (seq
      (db/save (get state :form))
      (notify "Project saved!")
      (emit :saved true))
    (seq
      (highlight-errors (get state :form))
      (warn "Please fix validation errors before saving"))))
```

---

## 8. Meta-Skill: S-Expression Generator

A skill that generates other skills (the meta-skill for AI integration).

```sexpr
(define-skill :sexpr-generator
  (inputs :task-description :context :examples)
  (outputs :generated-sexpr :generation-stats)
  (state {:model "sonnet" :temperature 0.3 :generated-count 0})
  (compute
    (let [task (get input :task-description)
          ctx (get input :context)
          prompt (build-prompt task ctx)
          result (llm-generate (get state :model) prompt)
          parsed (parse-sexpr result)]
      (if (valid? parsed)
        (do
          (set :generated-count (+ (get state :generated-count) 1))
          (emit :generated-sexpr parsed)
          (emit :generation-stats
            {:tokens (count-tokens result)
             :model (get state :model)
             :valid true
             :count (get state :generated-count)}))
        (emit :generation-stats
          {:valid false
           :error (get parsed :error)
           :raw result})))))
```

---

## 9. Data Flow Visualization S-Expression

The entire system as a single composable expression.

```sexpr
(define-system :neo-excel-ppt
  (skills
    :project-scope
    :component-calculator
    :activity-calculator
    :effort-aggregator
    :buffer-calculator)
  (wiring
    (connect :project-scope:total-files -> :component-calculator:file-count)
    (connect :project-scope:component-breakdown -> :component-calculator:breakdown)
    (connect :component-calculator:scaled-effort -> :effort-aggregator:component-effort)
    (connect :activity-calculator:activity-totals -> :effort-aggregator:activity-effort)
    (connect :effort-aggregator:total-days -> :buffer-calculator:base-days)
    (connect :buffer-calculator:buffer-days -> :effort-aggregator:buffer-days))
  (ui
    (layout :type :grid :cols 1 :gap 6
      (section :project-scope)
      (section :activities-table)
      (section :component-calculator)
      (layout :type :grid :cols 3 :gap 6
        (section :effort-breakdown)
        (section :proposed-buffers)
        (section :team-composition))))
  (history :enabled true :max-events 10000)
  (ai :upskill-enabled true :teacher "sonnet" :student "haiku"))
```

---

## Summary Statistics

| Metric | Value |
|--------|-------|
| Total skill definitions | 5 core + 1 meta |
| Total wiring connections | 6 |
| UI sections | 6 |
| UX action patterns | 4 |
| Avg S-expr tokens per skill | ~45 |
| Avg JSON tokens per skill | ~180 |
| Token efficiency ratio | 4:1 |
